DECLARE @SearchValue NVARCHAR(100) = 'PDU A11';
DECLARE @SchemaName NVARCHAR(100) = 'App';
DECLARE @SQL NVARCHAR(MAX) = '';
DECLARE @TableName NVARCHAR(256);
DECLARE @ColumnName NVARCHAR(128);

-- Cursor to go through all columns in the specified schema
DECLARE column_cursor CURSOR FOR
SELECT 
    t.name AS TableName,
    c.name AS ColumnName
FROM 
    sys.tables t
JOIN 
    sys.schemas s ON t.schema_id = s.schema_id
JOIN 
    sys.columns c ON c.object_id = t.object_id
JOIN 
    sys.types ty ON c.user_type_id = ty.user_type_id
WHERE 
    s.name = @SchemaName
    AND ty.name IN ('varchar', 'nvarchar', 'text')  -- Only text-based columns
    AND t.name NOT LIKE 'sys%'  -- Avoid system-like tables

OPEN column_cursor;
FETCH NEXT FROM column_cursor INTO @TableName, @ColumnName;

WHILE @@FETCH_STATUS = 0
BEGIN
    SET @SQL += '
    IF EXISTS (
        SELECT 1 FROM [' + @SchemaName + '].[' + @TableName + '] 
        WHERE [' + @ColumnName + '] LIKE ''%' + @SearchValue + '%''
    )
    BEGIN
        SELECT TOP 5 ''' + @SchemaName + '.' + @TableName + ''' AS TableName, 
               ''' + @ColumnName + ''' AS ColumnName, 
               [' + @ColumnName + '] AS ValueFound
        FROM [' + @SchemaName + '].[' + @TableName + ']
        WHERE [' + @ColumnName + '] LIKE ''%' + @SearchValue + '%''
        OPTION (MAXDOP 1);
    END
    ';

    FETCH NEXT FROM column_cursor INTO @TableName, @ColumnName;
END

CLOSE column_cursor;
DEALLOCATE column_cursor;

-- Execute the dynamic SQL
EXEC sp_executesql @SQL;
