WITH RECURSIVE loc_tree AS (
    -- Anchor: all base locations (roots)
    SELECT
        t.location_uuid,
        t.parent_loc_uuid,
        t.location_code,
        t.element_type,
        t.location_code::text AS base_code
    FROM psc_site_code_info t
    WHERE t.element_type = 'BaseLocation'
       OR t.parent_loc_uuid IS NULL

    UNION ALL

    -- Children: walk down the hierarchy
    SELECT
        c.location_uuid,
        c.parent_loc_uuid,
        c.location_code,
        c.element_type,
        p.base_code
    FROM psc_site_code_info c
    JOIN loc_tree p
      ON c.parent_loc_uuid = p.location_uuid
)
SELECT
    location_uuid,
    parent_loc_uuid,
    location_code,
    element_type,
    CASE
        WHEN element_type = 'BaseLocation'
             OR parent_loc_uuid IS NULL
        THEN base_code
        ELSE base_code || ' > ' || location_code
    END AS path
FROM loc_tree
ORDER BY base_code, path;
