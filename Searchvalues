WITH RECURSIVE loc_tree AS (
    SELECT
        t.location_uuid,
        t.parent_loc_uuid,
        t.location_code,
        t.element_type,
        t.location_code::text AS base_code
    FROM psc_site_code_info t
    WHERE t.element_type = 'BaseLocat'
       OR t.parent_loc_uuid IS NULL

    UNION ALL

    SELECT
        c.location_uuid,
        c.parent_loc_uuid,
        c.location_code,
        c.element_type,
        p.base_code
    FROM psc_site_code_info c
    JOIN loc_tree p
      ON c.parent_loc_uuid = p.location_uuid
)
SELECT
    CASE
        WHEN element_type = 'BaseLocat' THEN 'BaseLocat'
        WHEN lower(element_type) LIKE '%floor%' THEN 'Floor'
        ELSE 'Other'
    END AS type_bucket,
    COUNT(*) AS cnt
FROM loc_tree
WHERE element_type = 'BaseLocat'
   OR lower(element_type) LIKE '%floor%'
GROUP BY 1
ORDER BY 1;
